
from .. import loader
from asyncio import sleep
from telethon.tl.functions.account import UpdateStatusRequest

@loader.tds
class AlwaysOnlineMod(loader.Module):
    """–ú–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –¥–µ—Ä–∂–∏—Ç —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ –æ–Ω–ª–∞–π–Ω –≤ Telegram.

    üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: @user6268
    """
    strings = {"name": "AlwaysOnline"}

    async def client_ready(self, client, db):
        self.db = db

    async def alwaysonlinecmd(self, message):
        """–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –≤–µ—á–Ω—ã–π –æ–Ω–ª–∞–π–Ω. –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É: .alwaysonline"""
        status_key = "AlwaysOnline"
        if not self.db.get(status_key, "enabled", False):
            self.db.set(status_key, "enabled", True)
            await message.edit("‚úÖ –í–µ—á–Ω—ã–π –æ–Ω–ª–∞–π–Ω –≤–∫–ª—é—á–µ–Ω.\n–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: @user6268")
            while self.db.get(status_key, "enabled"):
                await message.client(UpdateStatusRequest(offline=False))
                await sleep(60)
        else:
            self.db.set(status_key, "enabled", False)
            await message.edit("‚ùå –í–µ—á–Ω—ã–π –æ–Ω–ª–∞–π–Ω –≤—ã–∫–ª—é—á–µ–Ω.\n–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: @user6268")
